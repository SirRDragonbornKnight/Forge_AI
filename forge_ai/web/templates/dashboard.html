{% extends "base.html" %}

{% block title %}Dashboard - Enigma Engine{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard">
    <h2>Dashboard</h2>
    
    <div class="ai-expression-widget">
        <div class="ai-mood">
            <span class="mood-text ai-status" id="ai-mood-emoji">[Ready]</span>
            <span class="mood-text" id="ai-mood-text">I'm feeling curious today!</span>
        </div>
        <div class="ai-interests">
            <h4>I enjoy talking about:</h4>
            <div class="interest-tags" id="ai-interests">
                <span class="tag">Loading...</span>
            </div>
        </div>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Status</h3>
            <p id="status">Loading...</p>
        </div>
        
        <div class="stat-card">
            <h3>Current Model</h3>
            <p id="model-name">Loading...</p>
        </div>
        
        <div class="stat-card">
            <h3>Running Instances</h3>
            <p id="instance-count">Loading...</p>
        </div>
        
        <div class="stat-card">
            <h3>Available Models</h3>
            <p id="model-count">Loading...</p>
        </div>
    </div>
    
    <div class="quick-actions">
        <h3>Quick Actions</h3>
        <div class="action-buttons">
            <a href="/chat" class="btn btn-primary">Start Chat</a>
            <a href="/personality" class="btn btn-secondary">Personality</a>
            <a href="/voice" class="btn btn-secondary">Voice Studio</a>
            <a href="/train" class="btn btn-secondary">Train Model</a>
            <a href="/settings" class="btn btn-secondary">Settings</a>
        </div>
    </div>
    
    <div class="recent-activity">
        <h3>System Information</h3>
        <div id="system-info">
            <p>Last updated: <span id="last-update">Never</span></p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Load dashboard data
async function loadDashboard() {
    try {
        const response = await fetch('/api/status');
        const data = await response.json();
        
        document.getElementById('status').textContent = data.model_loaded ? 'Running' : 'No Model';
        document.getElementById('model-name').textContent = data.model_name || 'None';
        document.getElementById('instance-count').textContent = data.instances || '1';
        document.getElementById('last-update').textContent = new Date(data.timestamp).toLocaleString();
        
        // Load models count
        const modelsResp = await fetch('/api/models');
        const modelsData = await modelsResp.json();
        document.getElementById('model-count').textContent = modelsData.models.length;
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
}

// Load AI mood
async function loadAIMood() {
    try {
        const response = await fetch('/api/ai/mood');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('ai-mood-emoji').textContent = data.emoji;
            document.getElementById('ai-mood-text').textContent = data.text;
            
            // Update interests
            const interestsDiv = document.getElementById('ai-interests');
            interestsDiv.innerHTML = '';
            data.interests.forEach(interest => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = interest;
                interestsDiv.appendChild(tag);
            });
        }
    } catch (error) {
        console.error('Error loading AI mood:', error);
    }
}

// Load on page load
loadDashboard();
loadAIMood();

// Refresh every 5 seconds
setInterval(loadDashboard, 5000);
</script>
{% endblock %}
