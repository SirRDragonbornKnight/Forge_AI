{% extends "base.html" %}

{% block title %}Settings - Enigma Engine{% endblock %}

{% block content %}
<div class="settings-container">
    <h2>⚙️ Settings</h2>
    
    <div class="settings-section">
        <h3>Model Settings</h3>
        <div class="form-group">
            <label for="active-model">Active Model:</label>
            <select id="active-model">
                <option>Loading...</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>
                <input type="checkbox" id="auto-learn">
                Auto-learn from conversations
            </label>
        </div>
    </div>
    
    <div class="settings-section">
        <h3>Personality Settings</h3>
        <p>Configure your AI's personality traits (0.0 = minimum, 1.0 = maximum)</p>
        <p class="settings-note" id="personality-note">Settings will be saved automatically</p>
        
        <div class="form-group">
            <label for="humor">Humor Level: <span id="humor-val">0.5</span></label>
            <input type="range" id="humor" min="0" max="1" step="0.1" value="0.5">
        </div>
        
        <div class="form-group">
            <label for="formality">Formality: <span id="formality-val">0.5</span></label>
            <input type="range" id="formality" min="0" max="1" step="0.1" value="0.5">
        </div>
        
        <div class="form-group">
            <label for="verbosity">Verbosity: <span id="verbosity-val">0.5</span></label>
            <input type="range" id="verbosity" min="0" max="1" step="0.1" value="0.5">
        </div>
        
        <div class="form-group">
            <label for="creativity">Creativity: <span id="creativity-val">0.5</span></label>
            <input type="range" id="creativity" min="0" max="1" step="0.1" value="0.5">
        </div>
        
        <button id="save-personality-btn" class="btn btn-primary">Save Personality</button>
        <button id="reset-personality-btn" class="btn btn-secondary">Reset to AI Defaults</button>
        <a href="/personality" class="btn btn-secondary">Advanced Personality →</a>
    </div>
    
    <div class="settings-section">
        <h3>Voice Settings</h3>
        <div class="form-group">
            <label for="voice-profile">Voice Profile:</label>
            <select id="voice-profile">
                <option value="default">Default</option>
                <option value="glados">GLaDOS</option>
                <option value="jarvis">Jarvis</option>
                <option value="robot">Robot</option>
            </select>
        </div>
        
        <button id="save-voice-btn" class="btn btn-primary">Save Voice</button>
        <a href="/voice" class="btn btn-secondary">Voice Studio →</a>
    </div>
    
    <div class="settings-section">
        <h3>Instance Management</h3>
        <div id="instances-list">
            <p>Loading instances...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Load models
async function loadModels() {
    try {
        const response = await fetch('/api/models');
        const data = await response.json();
        
        const select = document.getElementById('active-model');
        select.innerHTML = '';
        
        data.models.forEach(model => {
            const option = document.createElement('option');
            option.value = model.name;
            option.textContent = model.name;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading models:', error);
    }
}

// Load personality settings
async function loadPersonalitySettings() {
    try {
        const response = await fetch('/api/personality');
        const data = await response.json();
        
        if (data.success) {
            const personality = data.personality;
            document.getElementById('humor').value = personality.humor || 0.5;
            document.getElementById('formality').value = personality.formality || 0.5;
            document.getElementById('verbosity').value = personality.verbosity || 0.5;
            document.getElementById('creativity').value = personality.creativity || 0.5;
            
            // Update value displays
            document.getElementById('humor-val').textContent = (personality.humor || 0.5).toFixed(1);
            document.getElementById('formality-val').textContent = (personality.formality || 0.5).toFixed(1);
            document.getElementById('verbosity-val').textContent = (personality.verbosity || 0.5).toFixed(1);
            document.getElementById('creativity-val').textContent = (personality.creativity || 0.5).toFixed(1);
            
            // Show override status
            if (personality.user_controlled) {
                document.getElementById('personality-note').textContent = 'Using user-defined settings';
                document.getElementById('personality-note').style.color = 'var(--warning)';
            } else {
                document.getElementById('personality-note').textContent = 'AI is evolving naturally';
                document.getElementById('personality-note').style.color = 'var(--success)';
            }
        }
    } catch (error) {
        console.error('Error loading personality:', error);
    }
}

// Load voice settings
async function loadVoiceSettings() {
    try {
        const response = await fetch('/api/voice');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('voice-profile').value = data.voice.profile || 'default';
        }
    } catch (error) {
        console.error('Error loading voice settings:', error);
    }
}

// Save personality
async function savePersonality() {
    const settings = {
        humor: parseFloat(document.getElementById('humor').value),
        formality: parseFloat(document.getElementById('formality').value),
        verbosity: parseFloat(document.getElementById('verbosity').value),
        creativity: parseFloat(document.getElementById('creativity').value),
        user_controlled: true
    };
    
    try {
        const response = await fetch('/api/personality', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Personality settings saved!');
            loadPersonalitySettings();
        }
    } catch (error) {
        console.error('Error saving personality:', error);
        alert('Error saving personality settings');
    }
}

// Reset personality
async function resetPersonality() {
    if (!confirm('Reset personality to AI defaults?')) return;
    
    try {
        const response = await fetch('/api/personality/reset', {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Personality reset to defaults!');
            loadPersonalitySettings();
        }
    } catch (error) {
        console.error('Error resetting personality:', error);
        alert('Error resetting personality');
    }
}

// Save voice settings
async function saveVoice() {
    const settings = {
        profile: document.getElementById('voice-profile').value
    };
    
    try {
        const response = await fetch('/api/voice', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Voice settings saved!');
        }
    } catch (error) {
        console.error('Error saving voice:', error);
        alert('Error saving voice settings');
    }
}

// Update slider values
const sliders = ['humor', 'formality', 'verbosity', 'creativity'];
sliders.forEach(name => {
    const slider = document.getElementById(name);
    const valueSpan = document.getElementById(name + '-val');
    
    slider.addEventListener('input', () => {
        valueSpan.textContent = parseFloat(slider.value).toFixed(1);
    });
});

// Event listeners
document.getElementById('save-personality-btn').addEventListener('click', savePersonality);
document.getElementById('reset-personality-btn').addEventListener('click', resetPersonality);
document.getElementById('save-voice-btn').addEventListener('click', saveVoice);

// Load on page load
loadModels();
loadPersonalitySettings();
loadVoiceSettings();
</script>
{% endblock %}
